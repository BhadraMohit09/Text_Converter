<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Text Converter</title>
    <link id="favicon" rel="icon" href="">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts: Poppins & Space Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Custom CSS for Styling -->
    <style>
        /* --- Base & Body Styling --- */
        :root {
            --bg-color: #f0f2f5;
            --card-bg-color: #ffffff;
            --text-color: #333;
            --border-color: #e0e0e0;
            --muted-color: #6c757d;
            --primary-color: #0d6efd;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --input-bg: #fff;
            --input-border: #ced4da;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* --- Loading Screen --- */
        .loader-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.75s ease, visibility 0.75s ease;
            overflow: hidden;
        }

        .loader-wrapper.hidden {
            opacity: 0;
            visibility: hidden;
        }

        /* --- New Interactive Loader: Bubble Pop --- */
        #bubble-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .bubble {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, #a7c7fa, var(--primary-color));
            border-radius: 50%;
            cursor: pointer;
            animation: float 25s infinite linear;
            transition: transform 0.2s ease-out, opacity 0.2s ease-out;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.5), 0 0 15px rgba(13, 110, 253, 0.5);
        }
        
        .bubble.popped {
            transform: scale(1.2);
            opacity: 0;
        }
        
        #loader-text {
            color: var(--primary-color);
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            z-index: 10;
            animation: fadeInText 1s ease-out;
        }

        @keyframes float {
            0% { transform: translateY(0); }
            100% { transform: translateY(-120vh); }
        }
        
        @keyframes fadeInText {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }


        /* --- Header / Navbar --- */
        header {
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand { font-weight: 600; color: #fff; letter-spacing: 1px; }
        .navbar-brand i { color: #fff; }

        /* --- Main Content & Simple Card --- */
        main { flex: 1; }
        .main-card {
            background-color: var(--card-bg-color);
            border-radius: 1rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 24px var(--shadow-color);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out, background-color 0.3s ease, border-color 0.3s ease;
        }

        /* --- Form Elements --- */
        .form-control, .form-select {
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            border-radius: 0.5rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            background-color: var(--input-bg);
            color: var(--text-color);
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        
        .form-control::placeholder { color: #888; }
        textarea.form-control { min-height: 220px; resize: vertical; }
        #textStats { color: var(--muted-color); font-size: 0.85rem; transition: color 0.3s ease; }

        /* --- Custom Dropdown --- */
        .dropdown-toggle {
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
        }
        .dropdown-toggle:hover { border-color: #a3c9ff; }
        .dropdown-toggle:focus, .dropdown-toggle.show {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            background-color: var(--input-bg) !important;
            color: var(--text-color) !important;
        }
        .dropdown-menu {
            background-color: var(--card-bg-color);
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .dropdown-item { color: var(--text-color); padding: 0.5rem 1rem; }
        .dropdown-item:hover { background-color: rgba(13, 110, 253, 0.1); }
        .dropdown-item:active { background-color: var(--primary-color); color: #fff; }

        /* --- Buttons --- */
        .btn-primary, .btn-outline-primary, .btn-outline-danger, .btn-outline-secondary, .btn-outline-success {
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn:hover, .btn:focus { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
        .btn-primary:hover, .btn-primary:focus { box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3); }
        
        /* --- Mobile Button Grid Fix --- */
        .action-btn-grid > div {
            display: flex;
        }
        .action-btn-grid .btn {
            flex-grow: 1; /* Make buttons in the same row equal height */
        }

        /* --- Output Preview Area --- */
        #previewArea {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #555;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* --- Footer --- */
        footer {
            background: var(--card-bg-color);
            text-align: center;
            border-top: 1px solid var(--border-color);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out, background-color 0.3s ease, border-color 0.3s ease;
        }
        footer .social-icons a { color: var(--muted-color); font-size: 1.2rem; transition: color 0.3s ease, transform 0.3s ease; }
        footer .social-icons a:hover { color: var(--primary-color); transform: scale(1.1); }

        /* --- Smooth Load-in Animations --- */
        body.loaded header, body.loaded .main-card, body.loaded footer { opacity: 1; transform: translateY(0); }
        body.loaded .main-card { transition-delay: 0.2s; }
        body.loaded footer { transition-delay: 0.4s; }

        /* --- Mobile Friendliness --- */
        @media (max-width: 576px) {
            .card-title {
                font-size: 1.6rem;
            }
            .main-card {
                padding: 1.5rem !important;
            }
            textarea.form-control {
                min-height: 200px;
            }
            #loader-text {
                font-size: 1.2rem;
                padding: 0 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    
    <!-- Loading Screen -->
    <div id="loader" class="loader-wrapper">
        <div id="bubble-container"></div>
        <p id="loader-text">Pop the bubbles to begin!</p>
    </div>

    <!-- Header -->
    <header>
        <nav class="navbar navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="#"><i class="bi bi-file-earmark-code-fill"></i> Text Converter</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="py-4 py-md-5 d-flex align-items-center">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-10 col-lg-11">
                    <div class="card main-card p-3 p-md-5">
                        <div class="card-body">
                            <h2 class="card-title text-center mb-4 text-primary">Convert Your Text Instantly</h2>
                            
                            <div class="row g-4">
                                <!-- Left Side: Input & Actions -->
                                <div class="col-lg-7">
                                    <div class="mb-3">
                                        <label for="textInput" class="form-label fw-medium">Enter or paste your text below:</label>
                                        <textarea class="form-control" id="textInput" rows="10" placeholder="Type, paste, or upload text here..."></textarea>
                                        <div id="textStats" class="form-text text-end mt-2">Characters: 0 | Words: 0 | Lines: 0</div>
                                    </div>
                                    <div class="d-grid gap-2 d-sm-flex mb-3">
                                        <button class="btn btn-outline-primary" id="uploadBtn"><i class="bi bi-upload"></i> Upload</button>
                                        <button class="btn btn-outline-danger" id="clearBtn"><i class="bi bi-x-circle"></i> Clear</button>
                                        <input type="file" id="fileInput" accept=".txt,.csv" hidden>
                                    </div>
                                    <div class="row g-2 action-btn-grid">
                                        <div class="col-6"><button class="btn btn-sm btn-outline-secondary" id="upperCaseBtn">UPPER</button></div>
                                        <div class="col-6"><button class="btn btn-sm btn-outline-secondary" id="lowerCaseBtn">lower</button></div>
                                        <div class="col-6"><button class="btn btn-sm btn-outline-secondary" id="sentenceCaseBtn">Sentence</button></div>
                                        <div class="col-6"><button class="btn btn-sm btn-outline-secondary" id="titleCaseBtn">Title</button></div>
                                        <div class="col-6"><button class="btn btn-sm btn-outline-secondary" id="removeSpacesBtn"><i class="bi bi-text-paragraph"></i> Clean Spaces</button></div>
                                        <div class="col-6"><button class="btn btn-sm btn-outline-secondary" id="removeLinesBtn"><i class="bi bi-arrows-collapse"></i> Remove Lines</button></div>
                                        <div class="col-12"><button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#findReplaceModal"><i class="bi bi-search"></i> Find & Replace</button></div>
                                        <div class="col-12"><button class="btn btn-sm btn-outline-success" id="copyBtn"><i class="bi bi-clipboard"></i> Copy Text</button></div>
                                    </div>
                                </div>

                                <!-- Right Side: Conversion Options & Preview -->
                                <div class="col-lg-5 mt-4 mt-lg-0">
                                    <hr class="d-lg-none my-4">
                                    <div class="mb-3">
                                        <label for="formatDropdown" class="form-label fw-medium">Convert To:</label>
                                        <div class="dropdown">
                                            <button class="btn dropdown-toggle w-100" type="button" id="formatDropdown" data-bs-toggle="dropdown" aria-expanded="false">PDF Document (.pdf)</button>
                                            <ul class="dropdown-menu w-100" aria-labelledby="formatDropdown">
                                                <li><a class="dropdown-item" href="#" data-value="pdf">PDF Document (.pdf)</a></li>
                                                <li><a class="dropdown-item" href="#" data-value="csv">CSV File (.csv)</a></li>
                                                <li><a class="dropdown-item" href="#" data-value="txt">Text File (.txt)</a></li>
                                                <li><a class="dropdown-item" href="#" data-value="json">JSON Array (.json)</a></li>
                                            </ul>
                                        </div>
                                        <input type="hidden" id="selectedFormat" value="pdf">
                                    </div>

                                    <div class="mb-3">
                                        <label for="previewArea" class="form-label fw-medium">Live Preview:</label>
                                        <div id="previewArea" class="p-3"><span class="text-muted">Preview will appear here...</span></div>
                                    </div>

                                    <div class="d-grid"><button class="btn btn-primary btn-lg" id="convertBtn" disabled><i class="bi bi-download"></i> Convert & Download</button></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="py-3 mt-auto">
        <div class="container">
            <p class="mb-1 text-muted">Convert with MBTech</p>
            <div class="social-icons">
                <a href="https://github.com/BhadraMohit09" target="_blank" rel="noopener noreferrer" class="me-3"><i class="bi bi-github"></i></a>
                <a href="https://www.linkedin.com/in/bhadramohit27" target="blank" rel="noopener noreferrer" class="me-3"><i class="bi bi-linkedin"></i></a>
                <a href="https://x.com/Bhadra26" target="_blank" rel="noopener noreferrer"><i class="bi bi-twitter-x"></i></a>
            </div>
        </div>
    </footer>
    
    <!-- Find and Replace Modal -->
    <div class="modal fade" id="findReplaceModal" tabindex="-1" aria-labelledby="findReplaceModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="findReplaceModalLabel">Find and Replace</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="findInput" class="form-label">Find:</label>
                        <input type="text" class="form-control" id="findInput" placeholder="Text to find">
                    </div>
                    <div class="mb-3">
                        <label for="replaceInput" class="form-label">Replace with:</label>
                        <input type="text" class="form-control" id="replaceInput" placeholder="Text to replace with">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="replaceAllBtn">Replace All</button>
                </div>
            </div>
        </div>
    </div>


    <!-- JS Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript Logic -->
    <script>
        // --- Interactive Loader Logic ---
        const loader = document.getElementById('loader');
        const bubbleContainer = document.getElementById('bubble-container');
        const loaderText = document.getElementById('loader-text');
        let bubblesPopped = 0;
        

        function hideLoader() {
            loader.classList.add('hidden');
            document.body.classList.add('loaded');
        }

        function popBubble(bubble) {
            if (bubble.classList.contains('popped')) return;
            
            bubble.classList.add('popped');
            bubblesPopped++;
            
            // Optional: Add a subtle pop sound effect
            // new Audio('path/to/pop.mp3').play();
            const totalBubbles = window.innerWidth < 768 ? 10 : 15;
            if (bubblesPopped >= totalBubbles) {
                loaderText.textContent = "Great job!";
                setTimeout(hideLoader, 500);
            }
        }

        function setupBubbleLoader() {
            const totalBubbles = window.innerWidth < 768 ? 10 : 15;
            for (let i = 0; i < totalBubbles; i++) {
                const bubble = document.createElement('div');
                bubble.classList.add('bubble');
                
                const size = Math.random() * 60 + 20; // 20px to 80px
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${Math.random() * 100}vw`;
                bubble.style.bottom = `-${size}px`; // Start from below the screen
                bubble.style.animationDuration = `${Math.random() * 10 + 15}s`; // 15 to 25 seconds
                bubble.style.animationDelay = `${Math.random() * 5}s`;

                bubble.addEventListener('click', () => popBubble(bubble));
                bubbleContainer.appendChild(bubble);
            }
        }
        
        // --- App Logic ---
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- Animated Favicon Logic ---
            function animateFavicon() {
                const canvas = document.createElement('canvas');
                const size = 32;
                canvas.width = size;
                canvas.height = size;
                const context = canvas.getContext('2d');
                const faviconLink = document.getElementById('favicon');
                let frame = 0;

                function draw() {
                    context.clearRect(0, 0, size, size);
                    const pulse = Math.abs(Math.sin(frame * 0.1));
                    const radius = 6 + pulse * 3;
                    const alpha = 0.5 + pulse * 0.5;

                    context.beginPath();
                    context.arc(size / 2, size / 2, radius, 0, 2 * Math.PI);
                    context.fillStyle = `rgba(13, 110, 253, ${alpha})`;
                    context.fill();
                    
                    faviconLink.href = canvas.toDataURL('image/png');
                    frame++;
                }
                setInterval(draw, 100);
            }
            animateFavicon();
            
            // Setup loader on DOM ready
            setupBubbleLoader();

            // DOM Elements
            const textInput = document.getElementById('textInput');
            const convertBtn = document.getElementById('convertBtn');
            const clearBtn = document.getElementById('clearBtn');
            const uploadBtn = document.getElementById('uploadBtn');
            const fileInput = document.getElementById('fileInput');
            const previewArea = document.getElementById('previewArea');
            const textStats = document.getElementById('textStats');
            const copyBtn = document.getElementById('copyBtn');
            const upperCaseBtn = document.getElementById('upperCaseBtn');
            const lowerCaseBtn = document.getElementById('lowerCaseBtn');
            const sentenceCaseBtn = document.getElementById('sentenceCaseBtn');
            const titleCaseBtn = document.getElementById('titleCaseBtn');
            const findInput = document.getElementById('findInput');
            const replaceInput = document.getElementById('replaceInput');
            const replaceAllBtn = document.getElementById('replaceAllBtn');
            const findReplaceModal = new bootstrap.Modal(document.getElementById('findReplaceModal'));
            const removeSpacesBtn = document.getElementById('removeSpacesBtn');
            const removeLinesBtn = document.getElementById('removeLinesBtn');
            const formatDropdownBtn = document.getElementById('formatDropdown');
            const dropdownItems = document.querySelectorAll('.dropdown-menu .dropdown-item');
            const selectedFormatInput = document.getElementById('selectedFormat');

            // --- Event Listeners ---
            textInput.addEventListener('input', handleTextInput);
            clearBtn.addEventListener('click', clearAll);
            uploadBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            convertBtn.addEventListener('click', handleConversion);
            copyBtn.addEventListener('click', copyToClipboard);
            upperCaseBtn.addEventListener('click', toUpperCase);
            lowerCaseBtn.addEventListener('click', toLowerCase);
            sentenceCaseBtn.addEventListener('click', toSentenceCase);
            titleCaseBtn.addEventListener('click', toTitleCase);
            dropdownItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    formatDropdownBtn.textContent = this.textContent;
                    selectedFormatInput.value = this.dataset.value;
                    updatePreview();
                });
            });
            replaceAllBtn.addEventListener('click', handleReplaceAll);
            removeSpacesBtn.addEventListener('click', removeExtraSpaces);
            removeLinesBtn.addEventListener('click', removeLineBreaks);
            
            // --- Core Functions ---
            function handleTextInput() {
                const text = textInput.value;
                convertBtn.disabled = text.trim().length === 0;
                const charCount = text.length;
                const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
                const lineCount = text.split('\n').length;
                textStats.textContent = `Characters: ${charCount} | Words: ${wordCount} | Lines: ${lineCount}`;
                updatePreview();
            }

            function clearAll() {
                textInput.value = '';
                fileInput.value = '';
                handleTextInput();
            }

            function handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = e => { textInput.value = e.target.result; handleTextInput(); };
                reader.onerror = () => { alert('Error reading file.'); clearAll(); };
                reader.readAsText(file);
            }

            function updatePreview() {
                const text = textInput.value;
                const format = selectedFormatInput.value;
                if (text.trim().length === 0) {
                    previewArea.innerHTML = `<span class="text-muted">Preview will appear here...</span>`;
                    return;
                }
                let previewContent = '';
                const previewLines = text.split('\n').slice(0, 10).join('\n');
                switch (format) {
                    case 'pdf': previewContent = `A PDF document will be generated...\n\n${previewLines}...`; break;
                    case 'csv': previewContent = `Each line will be a row in the CSV...\n\n${previewLines.replace(/,/g, ' | ')}...`; break;
                    case 'json':
                        try {
                            const lines = text.split('\n').filter(line => line.trim() !== '');
                            previewContent = JSON.stringify(lines.slice(0,5), null, 2);
                            if(lines.length > 5) previewContent += '\n...';
                        } catch (e) { previewContent = 'Error generating JSON preview.'; }
                        break;
                    default: previewContent = previewLines + (text.split('\n').length > 10 ? '\n...' : ''); break;
                }
                previewArea.textContent = previewContent;
            }

            function handleConversion() {
                const text = textInput.value;
                if (text.trim().length === 0) return;
                const format = selectedFormatInput.value;
                const filename = `converted-${Date.now()}`;
                switch (format) {
                    case 'pdf': generatePdf(text, filename); break;
                    case 'csv': downloadBlob(text, `${filename}.csv`, 'text/csv;charset=utf-8;'); break;
                    case 'json':
                        const lines = text.split('\n').filter(line => line.trim() !== '');
                        const jsonContent = JSON.stringify(lines, null, 2);
                        downloadBlob(jsonContent, `${filename}.json`, 'application/json;charset=utf-8;');
                        break;
                    default: downloadBlob(text, `${filename}.txt`, 'text/plain;charset=utf-8;'); break;
                }
            }
            
            function toUpperCase() { textInput.value = textInput.value.toUpperCase(); handleTextInput(); }
            function toLowerCase() { textInput.value = textInput.value.toLowerCase(); handleTextInput(); }
            function toSentenceCase() {
                const text = textInput.value.toLowerCase();
                textInput.value = text.replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase());
                handleTextInput();
            }
            function toTitleCase() {
                const text = textInput.value.toLowerCase();
                textInput.value = text.replace(/\b\w/g, c => c.toUpperCase());
                handleTextInput();
            }
            function copyToClipboard() {
                if (!textInput.value) return;
                navigator.clipboard.writeText(textInput.value).then(() => {
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = `<i class="bi bi-check-lg"></i> Copied!`;
                    copyBtn.classList.replace('btn-outline-success', 'btn-success');
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                        copyBtn.classList.replace('btn-success', 'btn-outline-success');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    alert('Failed to copy text.');
                });
            }

            function handleReplaceAll() {
                const findValue = findInput.value;
                const replaceValue = replaceInput.value;
                if (findValue) {
                    textInput.value = textInput.value.replaceAll(findValue, replaceValue);
                    handleTextInput();
                }
                findReplaceModal.hide();
                findInput.value = '';
                replaceInput.value = '';
            }
            
            function removeExtraSpaces() {
                textInput.value = textInput.value.trim().replace(/\s\s+/g, ' ');
                handleTextInput();
            }
            
            function removeLineBreaks() {
                textInput.value = textInput.value.replace(/(\r\n|\n|\r)/gm, " ").trim().replace(/\s\s+/g, ' ');
                handleTextInput();
            }

            function generatePdf(text, filename) {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    doc.setFont('Helvetica', 'normal');
                    doc.setFontSize(11);
                    doc.setTextColor(51);
                    const margin = 15;
                    const textLines = doc.splitTextToSize(text, doc.internal.pageSize.getWidth() - margin * 2);
                    doc.text(textLines, margin, margin);
                    doc.save(`${filename}.pdf`);
                } catch (e) {
                    console.error("Error generating PDF:", e);
                    alert("Could not generate PDF.");
                }
            }

            function downloadBlob(content, filename, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        });
    </script>

</body>
</html>

